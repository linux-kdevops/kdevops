config BRINGUP_SUPPORTS_CXL
	bool

config KDEVOPS_ENABLE_GUESTFS
	bool
	output yaml

config KDEVOPS_ENABLE_NIXOS
	bool
	output yaml

config CLOUD_INITIALIZED
	bool
	default $(shell, test -f .cloud.initialized && echo y || echo n) = "y"

# CLI override detection for DECLARED_HOSTS which should enable SKIP_BRINGUP
config SKIP_BRINGUP_SET_BY_CLI
	bool
	default $(shell, scripts/check-cli-set-var.sh DECLARED_HOSTS)
	select SKIP_BRINGUP

choice
	prompt "Node bring up method"
	default TERRAFORM if CLOUD_INITIALIZED
	default GUESTFS if !CLOUD_INITIALIZED

config GUESTFS
	bool "Use guestfs-tools for local virtualization via KVM and libvirt"
	select KDEVOPS_ENABLE_GUESTFS
	select EXTRA_STORAGE_SUPPORTS_LARGEIO
	help
	  This option will use libguestfs utilities to build guest images and
	  spin them up using libvirt with KVM.

config TERRAFORM
	bool "Terraform for cloud environments"
	select EXTRA_STORAGE_SUPPORTS_512
	select EXTRA_STORAGE_SUPPORTS_1K
	select EXTRA_STORAGE_SUPPORTS_2K
	select EXTRA_STORAGE_SUPPORTS_4K
	help
	  Enable this if you want to use terraform to create nodes on a cloud
	  environment such as:

	    * Azure
	    * AWS
	    * OpenStack
	    * GCE

	  Enabling this option will enable installing terraform dependencies
	  when you run:

	    make deps

	  If you are not using a cloud environment just disable this.

config NIXOS
	bool "NixOS declarative configuration with libvirt"
	select KDEVOPS_ENABLE_NIXOS
	select EXTRA_STORAGE_SUPPORTS_512
	select EXTRA_STORAGE_SUPPORTS_1K
	select EXTRA_STORAGE_SUPPORTS_2K
	select EXTRA_STORAGE_SUPPORTS_4K
	select EXTRA_STORAGE_SUPPORTS_LARGEIO
	help
	  Use NixOS declarative configuration system to provision VMs with
	  libvirt. This provides a purely functional approach to VM management
	  with automatic dependency resolution based on enabled workflows.
	  NixOS will automatically infer the libvirt session type (system vs
	  user) based on your distribution's defaults, similar to guestfs.

config SKIP_BRINGUP
	bool "Skip bring up - bare metal or existing nodes"
	select EXTRA_STORAGE_SUPPORTS_512
	select EXTRA_STORAGE_SUPPORTS_1K
	select EXTRA_STORAGE_SUPPORTS_2K
	select EXTRA_STORAGE_SUPPORTS_4K
	help
	  This option will skip bring up, as you already have existing
	  systems up and available and ssh'able. This might be the case
	  if you are working with bare metal systems or systems you may
	  have already provisioned through other means.

endchoice

config LIBVIRT
	bool
	depends on GUESTFS || NIXOS
	default y

source "kconfigs/Kconfig.guestfs"
source "kconfigs/Kconfig.nixos"
source "terraform/Kconfig"
source "kconfigs/Kconfig.declared_hosts"
if LIBVIRT
source "kconfigs/Kconfig.libvirt"
endif
