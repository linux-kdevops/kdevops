# AWS P5.4xlarge GPU instance - Single NVIDIA H100 GPU
#
# This defconfig sets up an AWS P5.4xlarge instance with:
# - 1x NVIDIA H100 80GB GPU
# - 24 vCPUs
# - 192 GiB memory
# - 3.84 TB local NVMe SSD storage
# - 400 Gbps network with EFA v2 support
# - GPUDirect RDMA support
#
# Cost: ~$12.29/hour on-demand
#
# This is a more cost-effective option than P5.48xlarge for
# single-GPU workloads and development/testing purposes.

# Basic configuration
CONFIG_KDEVOPS_HOSTS_PREFIX="kdevops"
CONFIG_KDEVOPS_HOSTS_NUM_KEEP=1

# Use Terraform for AWS
CONFIG_TERRAFORM=y
CONFIG_TERRAFORM_AWS=y
CONFIG_TERRAFORM_AWS_DATA_ENABLE=y

# Skip extra storage configuration
CONFIG_TERRAFORM_EXTRA_VARS_AUTO=y

# Use us-east-1 for best availability
CONFIG_TERRAFORM_AWS_REGION_US_EAST_1=y
CONFIG_TERRAFORM_AWS_AZ_US_EAST_1A=y

# P5 instance with single H100 GPU
CONFIG_TERRAFORM_AWS_INSTANCE_FAMILY_P5=y
CONFIG_TERRAFORM_AWS_INSTANCE_SIZE_P5_4XLARGE=y

# Use default VPC to avoid VPC limit issues
# CONFIG_TERRAFORM_AWS_CREATE_VPC is not set
CONFIG_TERRAFORM_AWS_ASSIGN_PUBLIC_IP=y

# Storage configuration - suitable for ML workloads
CONFIG_TERRAFORM_AWS_EBS_VOLUMES_PER_INSTANCE=2
CONFIG_TERRAFORM_AWS_EBS_VOLUME_SIZE=500
CONFIG_TERRAFORM_AWS_EBS_VOLUME_TYPE_GP3=y