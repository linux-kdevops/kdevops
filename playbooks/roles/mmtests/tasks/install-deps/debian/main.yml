---
- name: Import optional extra_args file
  ansible.builtin.include_vars: "{{ item }}"
  ignore_errors: true
  with_first_found:
    - files:
        - "../extra_vars.yml"
        - "../extra_vars.yaml"
        - "../extra_vars.json"
      skip: true
  tags: vars

- name: Update apt cache
  become: true
  become_method: sudo
  ansible.builtin.apt:
    update_cache: true
  tags: deps

- name: Install mmtests build dependencies
  become: true
  become_method: sudo
  ansible.builtin.apt:
    name:
      - build-essential
      - git
      - perl
      - cpanminus
      - libmath-gradient-perl
      - r-base
      - r-base-dev
      - libnuma-dev
      - libmath-gradient-perl
    state: present
    update_cache: true
  tags: ["deps"]

- name: Install mmtests runtime dependencies
  become: true
  become_method: sudo
  ansible.builtin.apt:
    name:
      - numactl
      - fio
      - sysstat
      - procps
      - util-linux
      - coreutils
      - time
      - bc
      - psmisc
    state: present
    update_cache: true
  tags: ["deps"]

- name: Install mmtests monitoring dependencies
  become: true
  become_method: sudo
  ansible.builtin.apt:
    name:
      - trace-cmd
      - perf-tools-unstable
      - python3-bpfcc
    state: present
    update_cache: true
  tags: ["deps"]
  ignore_errors: true
