---
# Install dependencies for building linux on Debian

- name: Update apt cache
  become: true
  become_method: sudo
  ansible.builtin.apt:
    update_cache: true

# apt-get build-dep does not capture all requirements
- name: Install Linux kernel build dependencies
  become: true
  become_method: sudo
  ansible.builtin.apt:
    name:
      - bison
      - flex
      - git
      - gcc
      - make
      - gawk
      - bc
      - dump
      - indent
      - sed
      - libssl-dev
      - libelf-dev
      - liburcu-dev
      - xfsprogs
      - e2fsprogs
      - btrfs-progs
      - ntfs-3g
      - mdadm
      - rpcbind
      - portmap
      - hwinfo
      - open-iscsi
      - python3-pip
      - zstd
      - libncurses-dev
      - b4
      - ccache
    state: present

- name: Install .deb package build dependencies
  become: true
  become_method: sudo
  ansible.builtin.apt:
    name:
      - debhelper-compat
      - libdw-dev
      - dpkg-dev
    state: present
    update_cache: true
  retries: 3
  delay: 5
  register: debpkg_result
  until: debpkg_result is succeeded
  when:
    - bootlinux_9p_build_packages|default(false)|bool
