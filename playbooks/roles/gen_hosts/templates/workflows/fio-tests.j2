{# Workflow template for fio-tests #}
{% if fio_tests_multi_filesystem|default(false)|bool %}
{# Multi-filesystem section-based hosts #}
[all]
localhost ansible_connection=local
{% for node in all_generic_nodes %}
{{ node }}
{% endfor %}

[all:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

[baseline]
{% for node in all_generic_nodes %}
{% if not node.endswith('-dev') %}
{{ node }}
{% endif %}
{% endfor %}

[baseline:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

{% if kdevops_baseline_and_dev %}
[dev]
{% for node in all_generic_nodes %}
{% if node.endswith('-dev') %}
{{ node }}
{% endif %}
{% endfor %}

[dev:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

{% endif %}
[fio_tests]
{% for node in all_generic_nodes %}
{{ node }}
{% endfor %}

[fio_tests:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

{# Individual section groups for multi-filesystem testing #}
{% set section_names = [] %}
{% for node in all_generic_nodes %}
{% if not node.endswith('-dev') %}
{% set section = node.replace(kdevops_host_prefix + '-fio-tests-', '') %}
{% if section != kdevops_host_prefix + '-fio-tests' %}
{% if section_names.append(section) %}{% endif %}
{% endif %}
{% endif %}
{% endfor %}

{% for section in section_names %}
[fio_tests_{{ section | replace('-', '_') }}]
{{ kdevops_host_prefix }}-fio-tests-{{ section }}
{% if kdevops_baseline_and_dev %}
{{ kdevops_host_prefix }}-fio-tests-{{ section }}-dev
{% endif %}

[fio_tests_{{ section | replace('-', '_') }}:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

{% endfor %}
{% else %}
{# Single filesystem hosts (original behavior) #}
[all]
localhost ansible_connection=local
{{ kdevops_host_prefix }}-fio-tests
{% if kdevops_baseline_and_dev %}
{{ kdevops_host_prefix }}-fio-tests-dev
{% endif %}

[all:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

[baseline]
{{ kdevops_host_prefix }}-fio-tests

[baseline:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

{% if kdevops_baseline_and_dev %}
[dev]
{{ kdevops_host_prefix }}-fio-tests-dev

[dev:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

{% endif %}
[fio_tests]
{{ kdevops_host_prefix }}-fio-tests
{% if kdevops_baseline_and_dev %}
{{ kdevops_host_prefix }}-fio-tests-dev
{% endif %}

[fio_tests:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

[service]

[service:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"
{% endif %}
