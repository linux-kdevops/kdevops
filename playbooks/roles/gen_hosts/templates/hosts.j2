{#
We use lstrip_blocks to ensure this file can be read by developers and use
proper identation. We don't need identation for the ansible hosts file.

Each workflow which has its own custom ansible host file generated should use
its own jinja2 template file and define its own ansible task for its generation.
#}
{% if kdevops_workflows_dedicated_workflow %}
{% if workflows_reboot_limit %}
[all]
localhost ansible_connection=local
{{ kdevops_host_prefix }}-reboot-limit
{% if kdevops_baseline_and_dev %}
{{ kdevops_host_prefix }}-reboot-limit-dev
{% endif %}

[all:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

[baseline]
{{ kdevops_host_prefix }}-reboot-limit

[baseline:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

{% if kdevops_baseline_and_dev %}
[dev]
{{ kdevops_host_prefix }}-reboot-limit-dev

[dev:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

{% endif %}
[reboot-limit]
{{ kdevops_host_prefix }}-reboot-limit
{% if kdevops_baseline_and_dev %}
{{ kdevops_host_prefix }}-reboot-limit-dev
{% endif %}

[reboot-limit:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"
{% elif kdevops_workflow_enable_fio_tests %}
[all]
localhost ansible_connection=local
{{ kdevops_host_prefix }}-fio-tests
{% if kdevops_baseline_and_dev %}
{{ kdevops_host_prefix }}-fio-tests-dev
{% endif %}

[all:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

[baseline]
{{ kdevops_host_prefix }}-fio-tests

[baseline:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

{% if kdevops_baseline_and_dev %}
[dev]
{{ kdevops_host_prefix }}-fio-tests-dev

[dev:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

{% endif %}
[fio_tests]
{{ kdevops_host_prefix }}-fio-tests
{% if kdevops_baseline_and_dev %}
{{ kdevops_host_prefix }}-fio-tests-dev
{% endif %}

[fio_tests:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

[service]

[service:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"
{% elif kdevops_workflow_enable_ai %}
{% if ai_enable_multifs_testing|default(false)|bool %}
{# Multi-filesystem section-based hosts #}
[all]
localhost ansible_connection=local
{% for node in all_generic_nodes %}
{{ node }}
{% endfor %}

[all:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

[baseline]
{% for node in all_generic_nodes %}
{% if not node.endswith('-dev') %}
{{ node }}
{% endif %}
{% endfor %}

[baseline:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

{% if kdevops_baseline_and_dev %}
[dev]
{% for node in all_generic_nodes %}
{% if node.endswith('-dev') %}
{{ node }}
{% endif %}
{% endfor %}

[dev:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

{% endif %}
[ai]
{% for node in all_generic_nodes %}
{{ node }}
{% endfor %}

[ai:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

{# Individual section groups for multi-filesystem testing #}
{% set section_names = [] %}
{% for node in all_generic_nodes %}
{% if not node.endswith('-dev') %}
{% set section = node.replace(kdevops_host_prefix + '-ai-', '') %}
{% if section != kdevops_host_prefix + '-ai' %}
{% if section_names.append(section) %}{% endif %}
{% endif %}
{% endif %}
{% endfor %}

{% for section in section_names %}
[ai_{{ section | replace('-', '_') }}]
{{ kdevops_host_prefix }}-ai-{{ section }}
{% if kdevops_baseline_and_dev %}
{{ kdevops_host_prefix }}-ai-{{ section }}-dev
{% endif %}

[ai_{{ section | replace('-', '_') }}:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

{% endfor %}
{% else %}
{# Single filesystem hosts (original behavior) #}
[all]
localhost ansible_connection=local
{{ kdevops_host_prefix }}-ai
{% if kdevops_baseline_and_dev %}
{{ kdevops_host_prefix }}-ai-dev
{% endif %}

[all:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

[baseline]
{{ kdevops_host_prefix }}-ai

[baseline:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

{% if kdevops_baseline_and_dev %}
[dev]
{{ kdevops_host_prefix }}-ai-dev

[dev:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"

{% endif %}
[ai]
{{ kdevops_host_prefix }}-ai
{% if kdevops_baseline_and_dev %}
{{ kdevops_host_prefix }}-ai-dev
{% endif %}

[ai:vars]
ansible_python_interpreter = "{{ kdevops_python_interpreter }}"
{% endif %}
{% else %}
[all]
localhost ansible_connection=local
write-your-own-template-for-your-workflow-and-task
{% endif %}
{% else %}
[all]
localhost ansible_connection=local
{% if kdevops_enable_nixos|default(false) %}
{{ kdevops_host_prefix }} ansible_python_interpreter=/run/current-system/sw/bin/python3
{% else %}
{{ kdevops_host_prefix }}
{% endif %}
{% if kdevops_baseline_and_dev == True %}
{% if kdevops_enable_nixos|default(false) %}
{{ kdevops_host_prefix }}-dev ansible_python_interpreter=/run/current-system/sw/bin/python3
{% else %}
{{ kdevops_host_prefix }}-dev
{% endif %}
{% endif %}
{% if kdevops_enable_iscsi %}
{{ kdevops_host_prefix }}-iscsi
{% endif %}
{% if kdevops_nfsd_enable %}
{{ kdevops_host_prefix }}-nfsd
{% endif %}
[all:vars]
ansible_python_interpreter =  "{{ kdevops_python_interpreter }}"
[baseline]
{% if kdevops_enable_nixos|default(false) %}
{{ kdevops_host_prefix }} ansible_python_interpreter=/run/current-system/sw/bin/python3
{% else %}
{{ kdevops_host_prefix }}
{% endif %}
[baseline:vars]
ansible_python_interpreter =  "{{ kdevops_python_interpreter }}"
[dev]
{% if kdevops_baseline_and_dev %}
{% if kdevops_enable_nixos|default(false) %}
{{ kdevops_host_prefix }}-dev ansible_python_interpreter=/run/current-system/sw/bin/python3
{% else %}
{{ kdevops_host_prefix }}-dev
{% endif %}
{% endif %}
[dev:vars]
ansible_python_interpreter =  "{{ kdevops_python_interpreter }}"
{% if kdevops_enable_iscsi %}
[iscsi]
{{ kdevops_host_prefix }}-iscsi
[iscsi:vars]
ansible_python_interpreter =  "{{ kdevops_python_interpreter }}"
{% endif %}
{% if kdevops_nfsd_enable %}
[nfsd]
{{ kdevops_host_prefix }}-nfsd
[nfsd:vars]
ansible_python_interpreter =  "{{ kdevops_python_interpreter }}"
{% endif %}
[service]
{% if kdevops_enable_iscsi %}
{{ kdevops_host_prefix }}-iscsi
{% endif %}
{% if kdevops_nfsd_enable %}
{{ kdevops_host_prefix }}-nfsd
{% endif %}
[service:vars]
ansible_python_interpreter =  "{{ kdevops_python_interpreter }}"
{% endif %}
