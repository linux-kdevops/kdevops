---
# SPDX-License-Identifier: copyleft-next-0.3.1
#
# User-private KNLP role tasks

- name: Ensure parent directory exists for knlp
  ansible.builtin.file:
    path: "{{ knlp_data_path | dirname }}"
    state: directory
    mode: '0755'
  become: yes
  tags:
    - knlp

- name: Clone knlp repository
  ansible.builtin.git:
    repo: "{{ workflow_knlp_git_url | default(knlp_git_url) }}"
    dest: "{{ workflow_knlp_data | default(knlp_data_path) }}"
    version: "{{ workflow_knlp_git_ref | default(knlp_git_ref) }}"
    update: yes
  tags:
    - knlp

- name: Install knlp Python requirements
  ansible.builtin.pip:
    requirements: "{{ workflow_knlp_data | default(knlp_data_path) }}/requirements.txt"
    virtualenv: "{{ ansible_env.HOME }}/.venv"
    virtualenv_command: python3 -m venv
  tags:
    - knlp
